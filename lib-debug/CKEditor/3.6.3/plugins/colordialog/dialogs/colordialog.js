CKEDITOR.dialog.add("colordialog",function(e){function t(){l.getById(w).removeStyle("background-color"),h.getContentElement("picker","selectedColor").setValue(""),d&&d.removeAttribute("aria-selected"),d=null}function n(e){var t=e.data.getTarget(),n;t.getName()=="td"&&(n=t.getChild(0).getHtml())&&(d=t,d.setAttribute("aria-selected",!0),h.getContentElement("picker","selectedColor").setValue(n))}function r(e){e=e.replace(/^#/,"");for(var t=0,n=[];t<=2;t++)n[t]=parseInt(e.substr(t*2,2),16);var r=.2126*n[0]+.7152*n[1]+.0722*n[2];return"#"+(r>=165?"000":"fff")}function i(e){!e.name&&(e=new CKEDITOR.event(e));var t=!/mouse/.test(e.name),n=e.data.getTarget(),i;n.getName()=="td"&&(i=n.getChild(0).getHtml())&&(o(e),t?v=n:m=n,t&&(n.setStyle("border-color",r(i)),n.setStyle("border-style","dotted")),l.getById(y).setStyle("background-color",i),l.getById(b).setHtml(i))}function s(){var e=v.getChild(0).getHtml();v.setStyle("border-color",e),v.setStyle("border-style","solid"),l.getById(y).removeStyle("background-color"),l.getById(b).setHtml("&nbsp;"),v=null}function o(e){var t=!/mouse/.test(e.name),n=t&&v;if(n){var r=n.getChild(0).getHtml();n.setStyle("border-color",r),n.setStyle("border-style","solid")}!v&&!m&&(l.getById(y).removeStyle("background-color"),l.getById(b).setHtml("&nbsp;"))}function u(t){var r=t.data,i=r.getTarget(),s,o,u=r.getKeystroke(),a=e.lang.dir=="rtl";switch(u){case 38:if(s=i.getParent().getPrevious())o=s.getChild([i.getIndex()]),o.focus();r.preventDefault();break;case 40:if(s=i.getParent().getNext())o=s.getChild([i.getIndex()]),o&&o.type==1&&o.focus();r.preventDefault();break;case 32:case 13:n(t),r.preventDefault();break;case a?37:39:if(o=i.getNext())o.type==1&&(o.focus(),r.preventDefault(!0));else if(s=i.getParent().getNext())o=s.getChild([0]),o&&o.type==1&&(o.focus(),r.preventDefault(!0));break;case a?39:37:if(o=i.getPrevious())o.focus(),r.preventDefault(!0);else if(s=i.getParent().getPrevious())o=s.getLast(),o.focus(),r.preventDefault(!0);break;default:return}}function a(){function e(e,n){for(var i=e;i<e+3;i++){var s=new f(E.$.insertRow(-1));s.setAttribute("role","row");for(var o=n;o<n+3;o++)for(var u=0;u<6;u++)t(s.$,"#"+r[o]+r[u]+r[i])}}function t(e,t){var r=new f(e.insertCell(-1));r.setAttribute("class","ColorCell"),r.setAttribute("tabIndex",-1),r.setAttribute("role","gridcell"),r.on("keydown",u),r.on("click",n),r.on("focus",i),r.on("blur",o),r.setStyle("background-color",t),r.setStyle("border","1px solid "+t),r.setStyle("width","14px"),r.setStyle("height","14px");var s=g("color_table_cell");r.setAttribute("aria-labelledby",s),r.append(CKEDITOR.dom.element.createFromHtml('<span id="'+s+'" class="cke_voice_label">'+t+"</span>",CKEDITOR.document))}E=CKEDITOR.dom.element.createFromHtml('<table tabIndex="-1" aria-label="'+c.options+'"'+' role="grid" style="border-collapse:separate;" cellspacing="0">'+'<caption class="cke_voice_label">'+c.options+"</caption>"+'<tbody role="presentation"></tbody></table>'),E.on("mouseover",i),E.on("mouseout",o);var r=["00","33","66","99","cc","ff"];e(0,0),e(3,0),e(0,3),e(3,3);var s=new f(E.$.insertRow(-1));s.setAttribute("role","row");for(var a=0;a<6;a++)t(s.$,"#"+r[a]+r[a]+r[a]);for(var l=0;l<12;l++)t(s.$,"#000000")}var f=CKEDITOR.dom.element,l=CKEDITOR.document,c=e.lang.colordialog,h,p={type:"html",html:"&nbsp;"},d,v,m,g=function(e){return CKEDITOR.tools.getNextId()+"_"+e},y=g("hicolor"),b=g("hicolortext"),w=g("selhicolor"),E;return a(),{title:c.title,minWidth:360,minHeight:220,onLoad:function(){h=this},onHide:function(){t(),s()},contents:[{id:"picker",label:c.title,accessKey:"I",elements:[{type:"hbox",padding:0,widths:["70%","10%","30%"],children:[{type:"html",html:"<div></div>",onLoad:function(){CKEDITOR.document.getById(this.domId).append(E)},focus:function(){(v||this.getElement().getElementsByTag("td").getItem(0)).focus()}},p,{type:"vbox",padding:0,widths:["70%","5%","25%"],children:[{type:"html",html:"<span>"+c.highlight+'</span>												<div id="'+y+'" style="border: 1px solid; height: 74px; width: 74px;"></div>												<div id="'+b+'">&nbsp;</div><span>'+c.selected+'</span>												<div id="'+w+'" style="border: 1px solid; height: 20px; width: 74px;"></div>'},{type:"text",label:c.selected,labelStyle:"display:none",id:"selectedColor",style:"width: 74px",onChange:function(){try{l.getById(w).setStyle("background-color",this.getValue())}catch(e){t()}}},p,{type:"button",id:"clear",style:"margin-top: 5px",label:c.clear,onClick:t}]}]}]}]}});