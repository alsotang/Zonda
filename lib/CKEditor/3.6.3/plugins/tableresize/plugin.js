(function(){function e(e){return CKEDITOR.env.ie?e.$.clientWidth:parseInt(e.getComputedStyle("width"),10)}function t(e,t){var n=e.getComputedStyle("border-"+t+"-width"),r={thin:"0px",medium:"1px",thick:"2px"};return n.indexOf("px")<0&&(n in r&&e.getComputedStyle("border-style")!="none"?n=r[n]:n=0),parseInt(n,10)}function n(e){var t=e.$.rows,n=0,r,i,s;for(var o=0,u=t.length;o<u;o++)s=t[o],r=s.cells.length,r>n&&(n=r,i=s);return i}function r(e){var r=[],i=-1,s=e.getComputedStyle("direction")=="rtl",o=n(e),u=new CKEDITOR.dom.element(e.$.tBodies[0]),a=u.getDocumentPosition();for(var f=0,l=o.cells.length;f<l;f++){var c=new CKEDITOR.dom.element(o.cells[f]),h=o.cells[f+1]&&new CKEDITOR.dom.element(o.cells[f+1]);i+=c.$.colSpan||1;var p,d,v,m=c.getDocumentPosition().x;s?d=m+t(c,"left"):p=m+c.$.offsetWidth-t(c,"right"),h?(m=h.getDocumentPosition().x,s?p=m+h.$.offsetWidth-t(h,"right"):d=m+t(h,"left")):(m=e.getDocumentPosition().x,s?p=m:d=m+e.$.offsetWidth),v=Math.max(d-p,3),r.push({table:e,index:i,x:p,y:a.y,width:v,height:u.$.offsetHeight,rtl:s})}return r}function i(e,t){for(var n=0,r=e.length;n<r;n++){var i=e[n];if(t>=i.x&&t<=i.x+i.width)return i}return null}function s(e){(e.data||e).preventDefault()}function o(n){function r(){p=null,y=0,m=0,d.removeListener("mouseup",c),v.removeListener("mousedown",l),v.removeListener("mousemove",h),d.getBody().setStyle("cursor","auto"),f?v.remove():v.hide()}function i(){var t=p.index,n=CKEDITOR.tools.buildTableMap(p.table),r=[],i=[],o=Number.MAX_VALUE,u=o,a=p.rtl;for(var f=0,l=n.length;f<l;f++){var c=n[f],x=c[t+(a?1:0)],T=c[t+(a?0:1)];x=x&&new CKEDITOR.dom.element(x),T=T&&new CKEDITOR.dom.element(T);if(!x||!T||!x.equals(T))x&&(o=Math.min(o,e(x))),T&&(u=Math.min(u,e(T))),r.push(x),i.push(T)}b=r,w=i,E=p.x-o,S=p.x+u,v.setOpacity(.5),g=parseInt(v.getStyle("left"),10),y=0,m=1,v.on("mousemove",h),d.on("dragstart",s)}function o(){m=0,v.setOpacity(0),y&&u();var e=p.table;setTimeout(function(){e.removeCustomData("_cke_table_pillars")},0),d.removeListener("dragstart",s)}function u(){var n=p.rtl,r=n?w.length:b.length;for(var i=0;i<r;i++){var s=b[i],o=w[i],u=p.table;CKEDITOR.tools.setTimeout(function(e,t,r,i,s,o){e&&e.setStyle("width",a(Math.max(t+o,0))),r&&r.setStyle("width",a(Math.max(i-o,0))),s&&u.setStyle("width",a(s+o*(n?-1:1)))},0,this,[s,s&&e(s),o,o&&e(o),(!s||!o)&&e(u)+t(u,"left")+t(u,"right"),y])}}function l(e){s(e),i(),d.on("mouseup",c,this)}function c(e){e.removeListener(),o()}function h(e){x(e.data.$.clientX)}var p,d,v,m,g,y,b,w,E,S;d=n.document,v=CKEDITOR.dom.element.createFromHtml('<div data-cke-temp=1 contenteditable=false unselectable=on style="position:absolute;cursor:col-resize;filter:alpha(opacity=0);opacity:0;padding:0;background-color:#004;background-image:none;border:0px none;z-index:10"></div>',d),f||d.getDocumentElement().append(v),this.attachTo=function(e){if(m)return;f&&(d.getBody().append(v),y=0),p=e,v.setStyles({width:a(e.width),height:a(e.height),left:a(e.x),top:a(e.y)}),f&&v.setOpacity(.25),v.on("mousedown",l,this),d.getBody().setStyle("cursor","col-resize"),v.show()};var x=this.move=function(e){if(!p)return 0;if(!m&&(e<p.x||e>p.x+p.width))return r(),0;var t=e-Math.round(v.$.offsetWidth/2);if(m){if(t==E||t==S)return 1;t=Math.max(t,E),t=Math.min(t,S),y=t-g}return v.setStyle("left",a(t)),1}}function u(e){var t=e.data.getTarget();if(e.name=="mouseout"){if(!t.is("table"))return;var n=new CKEDITOR.dom.element(e.data.$.relatedTarget||e.data.$.toElement);while(n&&n.$&&!n.equals(t)&&!n.is("body"))n=n.getParent();if(!n||n.equals(t))return}t.getAscendant("table",1).removeCustomData("_cke_table_pillars"),e.removeListener()}var a=CKEDITOR.tools.cssLength,f=CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks||CKEDITOR.env.version<7);CKEDITOR.plugins.add("tableresize",{requires:["tabletools"],init:function(e){e.on("contentDom",function(){var t;e.document.getBody().on("mousemove",function(n){n=n.data;if(t&&t.move(n.$.clientX)){s(n);return}var a=n.getTarget(),f,l;if(!a.is("table")&&!a.getAscendant("tbody",1))return;f=a.getAscendant("table",1),(l=f.getCustomData("_cke_table_pillars"))||(f.setCustomData("_cke_table_pillars",l=r(f)),f.on("mouseout",u),f.on("mousedown",u));var c=i(l,n.$.clientX);c&&(!t&&(t=new o(e)),t.attachTo(c))})})}})})();